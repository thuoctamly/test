testthoigianneunhohon319thiok<!doctype html>
<html lang="vi">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#004080">

<!-- Báº¯t buá»™c cho iPhone -->
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="color-scheme" content="light">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ThÆ°á»›c pháº£n tÆ° tÃ¢m lÃ½ vÃ  khÆ¡i dáº­y nhÃ¢n tÃ­nh lÃ m ngÆ°á»i</title>
<style>
  :root{
    --bg:#f4f7fb;
    --ruler-bg:#0b63a8;
    --slider:#ffffff;
    --led-size:48px;
    --green:#2ecc71; --amber:#f39c12; --red:#e74c3c; --white:#ffffff;
  }
 body {
  font-family: system-ui,Segoe UI,Roboto,Helvetica,Arial;
  margin:0;
  padding:12px;
  background-color: #ffffff !important;
  color: #123 !important;
  color-scheme: light only;
-webkit-appearance: none;
  forced-color-adjust: none;
}
.container{max-width:420px;margin:0 auto;}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
h1{font-size:16px;margin:0}
small{color:#456}
.ruler-wrap{display:flex;gap:12px;align-items:center}
.ruler{
  width:80px; 
  height:500px; 
  background:#ffffff; 
  border-top: 40px solid #004080;
  border-right: 10px solid #004080; 
  border-bottom: 20px solid #004080;
  border-left: 10px solid #004080; 
  border-radius:10px;
  position:relative;
  box-shadow:0 4px 10px rgba(0,0,0,0.12); 
  margin:auto;
  touch-action:none;
}
.tick { 
  position: absolute; 
  left: 8px; 
  right: 8px; 
  height: 1px; 
  background: rgba(0,0,0,0.5);
}
.label{position:absolute; left:50px; transform:translateX(-100%); color:#000; font-weight:600; font-size:12px}
.slider{
  position:absolute; left:6px; right:6px; height:10px; border-radius:6px; border: 5px solid #000; background:var(--slider);
  display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,0.25);
  touch-action:none; user-select:none; cursor:grab;
  font-weight:600; font-size:13px;
}
.slider .knob {
  width: 17px;
  height: 17px;
  background: blue;
  border: 4px solid #000;
  border-radius: 4px;
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  pointer-events: none;
}
.slider:active{background:#eaeaea}
.led{position: absolute; top: -35px; left: 30%; width:24px; height:24px; border-radius:50%; border: 4px solid #000; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.25)}
.led.white{background:var(--white)}
.led.green{background:var(--green)}
.led.amber{background:var(--amber)}
.led.red{background:var(--red)}
.led.pulse{animation:ledPulse 1s infinite}
@keyframes ledPulse{0%{box-shadow:0 0 6px rgba(255,255,255,0.12)}50%{box-shadow:0 0 18px rgba(0,0,0,0.18)}100%{box-shadow:0 0 6px rgba(255,255,255,0.12)}}
.status{margin-top:10px; display:flex;justify-content:space-between;align-items:center}
.countdown,.total{font-weight:700}
.controls {
  margin-top: 12px;
  display: flex;
  justify-content: center;  /* cÄƒn giá»¯a theo ngang */
  gap: 12px;               /* khoáº£ng cÃ¡ch giá»¯a 2 nÃºt */
  flex-wrap: wrap;          /* xuá»‘ng dÃ²ng khi mÃ n hÃ¬nh nhá» */
}

.btn{background:#fff;border:1px solid #d0d7de;padding:8px 10px;border-radius:8px;cursor:pointer}
.btn.warn{background:#f6d7cf}
.footer{margin-top:14px;font-size:13px;color:#456}

.hidden { display: none; }

/* LED cam nháº¥p nhÃ¡y theo nhá»‹p tiáº¿ng cÃ²i (~210ms) */
.led.pulse {
  animation: pulseFlash 1s infinite;
}

@keyframes pulseFlash {
  0%   { opacity: 1; }
  50%  { opacity: 0; }
  100% { opacity: 1; }
}
/* LED Ä‘á» pulse riÃªng */
/* Hiá»‡u á»©ng riÃªng cho LED Ä‘á» â€” hoÃ n toÃ n tÃ¡ch biá»‡t */
.led-red-alert {
  animation: ledRedFlash 0.5s infinite ease-in-out;
}

@keyframes ledRedFlash {
  0%   { background: #e74c3c; box-shadow: 0 0 6px #e74c3c; }
  50%  { background: #3d0000; box-shadow: 0 0 12px #ff1a1a; }
  100% { background: #e74c3c; box-shadow: 0 0 6px #e74c3c; }
}


.pulse-amber {
  animation: amberBlink 1.885s infinite;
}

@keyframes amberBlink {
  0% { opacity: 1; }
  50% { opacity: 0.1; }
  100% { opacity: 1; }
}

.label-left {
  position: absolute;
  left: -110px; /* cÄƒn trÃ¡i ra ngoÃ i 1 chÃºt, báº¡n chá»‰nh tÃ¹y Ã½ */
  width: 100px;
  color: #004080;
  font-weight: 600;
  font-size: 13px;
  user-select: none;
}

.label-left.top {
  top: 0px; /* gáº§n top border */
  left:-125px;
 
}

.label-left.middle {
  top: 51%; 
  left: -130px;
  transform: translateY(-50%);
}

.label-left.bottom {
  bottom: -15px; /* gáº§n bottom border */
  left:-130px;
}
.label-right{
  position: absolute;
  left: -110px; /* cÄƒn trÃ¡i ra ngoÃ i 1 chÃºt, báº¡n chá»‰nh tÃ¹y Ã½ */
  width: 100px;
  color: #004080;
  font-weight: 600;
  font-size: 13px;
  user-select: none;
}

.label-right.top {
  top: 0px; /* gáº§n top border */
  left:-118px;
 
}

.label-right.middle {
  top: 49%; 
  left: -118px;
  transform: translateY(-50%);
}

.label-right.bottom {
  bottom: 0px; /* gáº§n bottom border */
  left:-118px;
}
/* ==== NÃšT Äá»’NG Bá»˜ â€“ SANG TRá»ŒNG NHÆ¯ iOS ==== */
.btn {
  padding: 8px 14px;
  border-radius: 10px;
  background: #ffffff;
  border: 2px solid #004080;
  color: #004080;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: 0.25s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.12);
}

.btn:hover {
  background: #004080;
  color: #ffffff;
  box-shadow: 0 3px 6px rgba(0,0,0,0.18);
}

.btn:active {
  transform: scale(0.96);
}

/* NÃºt cáº£nh bÃ¡o */
.btn.warn {
  border-color: #b00020;
  color: #b00020;
}

.btn.warn:hover {
  background: #b00020;
  color: white;
}

/* CÃ¡c nÃºt khÃ´ng cÃ³ class cÅ©ng Ä‘Æ°á»£c Ä‘á»“ng bá»™ */
#revBtn {
  padding: 9px 16px;
  border-radius: 10px;
  background: #ffffff;
  border: 2px solid #004080;
  color: #004080;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: 0.25s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.12);
}

#revBtn:hover {
  background: #004080;
  color: #ffffff;
  box-shadow: 0 3px 6px rgba(0,0,0,0.18);
}

#revBtn:active {
  transform: scale(0.96);
}
strong {
  font-weight: 1000 !important;
}

</style>
</head>
<body>
<div id="helpModal" style="display:none; position:fixed; top:50%; left:50%; transform: translate(-50%, -50%); width:90%; height:85%; background:#fff; border:2px solid #004080; padding:12px; overflow:auto; z-index:1000; box-shadow:0 4px 12px rgba(0,0,0,0.3);">
  <button id="closeHelp" style="margin-bottom:8px;">ÄÃ³ng</button>
  <pre id="helpText" style="white-space: pre-wrap; font-size:18px;"></pre>
</div>
<!-- Modal Nháº­t kÃ½ -->
<div id="reviewModal" style="
  display:none; position:fixed; top:50%; left:50%; transform: translate(-50%, -50%); width:90%; height:85%;
  background:#fff; border:2px solid #004080; padding:12px; overflow:auto;
  z-index:1000; box-shadow:0 4px 12px rgba(0,0,0,0.3);
">
  <button id="closeReview" style="margin-bottom:8px;">ÄÃ³ng</button>
<div id="reviewContent" style="font-size:16px;"></div>
</div>

<div class="container">
  <header>
    <div>
      <h1>THÆ¯á»šC PHáº¢N TÆ¯ TÃ‚M LÃ VÃ€ KHÆ I Dáº¬Y NHÃ‚N TÃNH LÃ€M NGÆ¯á»œIğŸ–¤ğŸ•Šï¸</h1>
      <small><em><b>(Láº¥y cáº£m há»©ng tá»« thuyáº¿t PhÃ¢n TÃ¢m há»c cá»§a Sigmund Freud)</b></em></small>
    </div>
  </header>

  <div class="ruler-wrap">
  
    <div style="flex:1">
      <div id="ruler" class="ruler">
      <div class="label-left top" style="font-size:14px; color:rgb(255,215,0)" align="center">ğŸ˜‡<b> SIÃŠU NGÃƒ (+10000)</b></div>
<div class="label-left middle" style="font-size:14px" align="center"><svg width="24" height="24" viewBox="0 0 24 17" fill="#004080" xmlns="http://www.w3.org/2000/svg">
  <circle cx="12" cy="7" r="4"/>
  <path d="M12 14c-5 0-8 2.5-8 5v1h16v-1c0-2.5-3-5-8-5z"/>
</svg>
<b>Báº¢N <span style="color:rgb(255,215,0)">NGÃƒ</span> (0)</b></div>
<div class="label-left bottom" style="font-size:14px" align="center">ğŸ˜ˆ<b> Báº¢N NÄ‚NG (-10000)</b></div>

        <div id="led" class="led" title="LED tráº¡ng thÃ¡i"></div>
        <div id="slider" class="slider">
          &nbsp;â¬‡ï¸
          <div class="knob"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="status">
    <div>Thá»i gian cÃ²n láº¡i: <span id="countdown" class="countdown">--</span></div>
    <div id="totalScore" style="display:none;">Tá»•ng Ä‘iá»ƒm: <span id="total" class="total">0</span></div>
  </div>

  <div class="controls">
    <button id="resetBtn" class="btn warn">Reset</button>
    <button id="revBtn">Há»“i vá»‹</button>
    <button id="helpBtn" class="btn">HÆ°á»›ng dáº«n</button>
    <button id="reviewBtn" class="btn">Nháº­t kÃ½</button>

  </div>

  <div class="footer">
    <strong>LÆ°u Ã½:</strong> ThÆ°á»›c chá»‰ cÃ³ tÃ¡c dá»¥ng giÃ¡o dá»¥c tá»± pháº£n tÆ°, khÃ´ng dÃ¹ng Ä‘á»ƒ phÃ¡n xÃ©t nhÃ¢n cÃ¡ch, khÃ´ng thá»ƒ thay tháº¿ Ä‘iá»u trá»‹ tÃ¢m lÃ½ chuyÃªn mÃ´n.
  </div>
</div>

<script>
const CURRENT_CYCLE_KEY = 'freudRuler_current_cycle'; // KhÃ³a lÆ°u tráº¡ng thÃ¡i chu ká»³ Ä‘ang cháº¡y
const FINISHED_CYCLES_KEY = 'freudRuler_cycles_history'; // KhÃ³a lÆ°u Lá»ŠCH Sá»¬ VÄ¨NH VIá»„N

function loadFinishedCycles() {
    try {
        const cycles = localStorage.getItem(FINISHED_CYCLES_KEY);
        return cycles ? JSON.parse(cycles) : [];
    } catch (e) {
        console.error("Could not load finished cycles", e);
        return [];
    }
}

function saveFinishedCycles(cycles) {
    try {
        localStorage.setItem(FINISHED_CYCLES_KEY, JSON.stringify(cycles));
    } catch (e) {
        console.error("Could not save finished cycles", e);
    }
}

function loadCurrentCycle() {
    try {
        const current = localStorage.getItem(CURRENT_CYCLE_KEY);
        if (current) return JSON.parse(current);
    } catch (e) {
        console.error("Could not load current cycle", e);
    }
    // Tráº£ vá» state máº·c Ä‘á»‹nh náº¿u khÃ´ng cÃ³ dá»¯ liá»‡u
    return { status:'idle', startTimestamp:null, entries:[], total:0 };
}

function saveCurrentCycle() {
    try {
        // Sao chÃ©p vÃ  lÆ°u state hiá»‡n táº¡i (khÃ´ng cáº§n lÆ°u finishedCycles)
        const dataToSave = {
            status: state.status,
            startTimestamp: state.startTimestamp,
            entries: state.entries,
            total: state.total
        };
        localStorage.setItem(CURRENT_CYCLE_KEY, JSON.stringify(dataToSave));
    } catch (e) {
        console.error("Could not save current cycle", e);
    }
}
const STORAGE_KEY = 'freudRuler_v2';
const MS_COUNTDOWN = 200000; // 168 giá»

const MIN_VALUE = -10000, MAX_VALUE = 10000;
let audioEnabled = true;

const LED = document.getElementById('led');
const slider = document.getElementById('slider');
const ruler = document.getElementById('ruler');
const countdownEl = document.getElementById('countdown');
const totalEl = document.getElementById('total');
const resetBtn = document.getElementById('resetBtn');
const helpBtn = document.getElementById('helpBtn');
let state = loadCurrentCycle(); // Táº£i chu ká»³ Ä‘ang cháº¡y dá»Ÿ (náº¿u cÃ³)
state.finishedCycles = loadFinishedCycles(); // Táº£i lá»‹ch sá»­ VÄ¨NH VIá»„N
// Ã‚m thanh
// Ghi nháº­n 1 láº§n gáº¡t trong chu ká»³
function logEntry(value) {
    const now = new Date();
    const entry = {
        value: value,
        dir: value > 0 ? "SiÃªu NgÃ£" : value < 0 ? "Báº£n NÄƒng" : "Báº£n NgÃ£",
        time: now.toLocaleTimeString('vi-VN'),
        date: now.toLocaleDateString('vi-VN')
    };

    state.entries.push(entry);
    saveCurrentCycle();
}

function playBeep(freq=880, dur=0.12, vol=0.15){
  if(!audioEnabled) return;
  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  const o = ctx.createOscillator(); const g = ctx.createGain();
  o.type='sine'; o.frequency.value=freq; g.gain.value=vol;
  o.connect(g); g.connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime+dur);
}

// Chuyá»ƒn value <-> y
// Chuyá»ƒn value <-> y, Ä‘á»“ng bá»™ vá»›i tick
// 1) inner height â€” dÃ¹ng clientHeight (clientHeight Ä‘Ã£ exclude border)
function getInnerH() {
  return ruler.clientHeight; 
}

// 2) value -> top (tráº£ top Ä‘á»ƒ gÃ¡n slider.style.top)
//    Ta tÃ­nh centerY trong khoáº£ng [0 .. clientHeight], rá»“i trá»« ná»­a slider Ä‘á»ƒ ra top.
function valueToY(value) {
  // dÃ¹ng kÃ­ch thÆ°á»›c thá»±c táº¿ táº¡i thá»i Ä‘iá»ƒm cháº¡y
  const innerH = ruler.clientHeight;          // vÃ¹ng ná»™i bá»™ (client area) cá»§a ruler
  const sliderH = slider.offsetHeight || 20;  // fallback 20 náº¿u chÆ°a render xong

  // tÃ¢m slider cÃ³ thá»ƒ náº±m trong [top, bottom]
  const top = sliderH / 2;
  const bottom = innerH - sliderH / 2;

  // ratio 0..1 cho value
  const ratio = (value - MIN_VALUE) / (MAX_VALUE - MIN_VALUE);

  // vá»‹ trÃ­ tÃ¢m theo tá»· lá»‡ (MIN -> top, MAX -> bottom)
  const centerY = top + ratio * (bottom - top);

  // tráº£ vá» top Ä‘á»ƒ gÃ¡n slider.style.top
  return centerY - sliderH / 2;
}

function yToValue(centerY) {
  const innerH = ruler.clientHeight;
  const sliderH = slider.offsetHeight || 20;

  const top = sliderH / 2;
  const bottom = innerH - sliderH / 2;

  const c = Math.min(bottom, Math.max(top, centerY));

  const ratio = (c - top) / (bottom - top); // 0..1

  // FIX NGÆ¯á»¢C CHIá»€U â†’ khÃ´ng cÃ²n lá»—i 10000/-10000 sai vá»‹ trÃ­
  return Math.round(MAX_VALUE - ratio * (MAX_VALUE - MIN_VALUE));
}

function clamp(v,a,b){return Math.min(Math.max(v,a),b);}

// LED
function LED_set(color){ LED.className='led '+color; }
function LED_clear() { LED.className='led'; LED.style.background = '#222'; }

// Tick & label
function renderTicks() {
  ruler.querySelectorAll('.tick,.label').forEach(n => n.remove());

  const tickCount = 21;
  const innerHeight = ruler.clientHeight - 1;
  const spacing = innerHeight / (tickCount - 1);

  for (let i = 0; i < tickCount; i++) {
    const t = document.createElement('div');
    t.className = 'tick';
    t.style.top = (i * spacing) + 'px';
    ruler.appendChild(t);
  }
}



// Slider kÃ©o
let dragging=false;
let dragOffset=0;
let moved = false;
let startY = 0; // â­ thÃªm biáº¿n nÃ y

function initSlider(){
  renderTicks();
  requestAnimationFrame(()=> placeSliderAtValue(0));

  // pointerdown
  slider.addEventListener('pointerdown', e=>{
    dragging = true;
    moved=false;
    slider.setPointerCapture(e.pointerId);
    slider.style.cursor = 'grabbing';

    startY = e.clientY; // â­ lÆ°u vá»‹ trÃ­ báº¯t Ä‘áº§u
    
    const sliderTop = parseFloat(slider.style.top) || 0;
    dragOffset = e.clientY - (ruler.getBoundingClientRect().top + sliderTop);
  });

  // pointermove
  document.addEventListener('pointermove', e=>{
    if(!dragging) return;

    // â­ Chá»‰ coi lÃ  "kÃ©o" khi di chuyá»ƒn > 10px
    if (Math.abs(e.clientY - startY) > 10) {
      moved = true;
    }

    const sliderHeight = slider.getBoundingClientRect().height;
    const rect = ruler.getBoundingClientRect();

    const minY = 0;
    const maxY = ruler.clientHeight - sliderHeight;

    let y = e.clientY - rect.top - dragOffset;
    y = clamp(y, minY, maxY);

    slider.style.top = y + 'px';
  });

  // pointerup
  document.addEventListener('pointerup', e=>{
    dragging=false;
    slider.style.cursor='grab';

    const value = currentValue;
    logEntry(value);
  });

  // click
  slider.addEventListener('click', e=>{
    // Náº¿u cÃ³ kÃ©o (moved = true) â†’ KHÃ”NG tÃ­nh Ä‘iá»ƒm
    if (moved) {
      e.stopPropagation();
      return;
    }

    // â­ KhÃ´ng kÃ©o â†’ lÃ  NHáº¤N â†’ tÃ­nh Ä‘iá»ƒm
    confirmEntry();
  });

}


// Äáº·t slider theo value
function placeSliderAtValue(v){
  slider.style.top = valueToY(v) + 'px';
}

// Khi nháº¥n confirm

function confirmEntry(){
  if(state.status!=='running'){
    alert('Nháº¥n Reset Ä‘á»ƒ Ä‘Æ°a Tá»•ng Ä‘iá»ƒm vá» 0 vÃ  báº¯t Ä‘áº§u láº¡i chu kÃ¬ 1 tuáº§n tá»± pháº£n tÆ°.');
    return;
  }

  const rect = ruler.getBoundingClientRect();
  const sliderRect = slider.getBoundingClientRect();
  // centerY tÃ­nh theo khÃ´ng gian Ná»˜I Bá»˜ cá»§a ruler (client space)
  const y = slider.offsetTop + slider.offsetHeight/2;

  const v = yToValue(y);

  // ---------- HIá»†N ÄIá»‚M Tá»¨C THá»œI (show instant score) ----------
  let inst = document.getElementById('instantScore');
  if(!inst){
    inst = document.createElement('div');
    inst.id = 'instantScore';
    inst.style.position = 'absolute';
    inst.style.display = 'none';
    inst.style.fontWeight = '700';
    inst.style.fontSize = '16px';
    inst.style.lineHeight = '1';
    inst.style.padding = '4px 8px';
    inst.style.borderRadius = '6px';
    inst.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';
    inst.style.background = 'rgba(255,255,255,0.98)';
    inst.style.pointerEvents = 'none';
    inst.style.zIndex = '9999';
    inst.style.transition = 'opacity 0.25s ease';
    inst.style.color = '#004080';
    document.body.appendChild(inst);
  }

  // Láº¥y bounding rect chÃ­nh xÃ¡c cá»§a #totalScore.
  // Náº¿u #totalScore Ä‘ang display:none -> táº¡m set display:block + visibility:hidden Ä‘á»ƒ Ä‘o rá»“i phá»¥c há»“i.
  const totalBox = document.getElementById('totalScore');
  let targetRect;
  if (totalBox) {
    const cs = window.getComputedStyle(totalBox);
    let restored = false;
    const prevDisplay = totalBox.style.display; // lÆ°u giÃ¡ trá»‹ inline trÆ°á»›c
    if (cs.display === 'none') {
      // táº¡m hiá»‡n nhÆ°ng áº©n máº¯t báº±ng visibility Ä‘á»ƒ khÃ´ng gÃ¢y flicker
      totalBox.style.display = 'block';
      totalBox.style.visibility = 'hidden';
      restored = true;
    }
    targetRect = totalBox.getBoundingClientRect();
    if (restored) {
      // phá»¥c há»“i tráº¡ng thÃ¡i cÅ©
      totalBox.style.display = prevDisplay || 'none';
      totalBox.style.visibility = '';
    }
  } else {
    // fallback: dÃ¹ng .status náº¿u khÃ´ng tÃ¬m tháº¥y #totalScore
    const statusEl = document.querySelector('.status') || document.body;
    targetRect = statusEl.getBoundingClientRect();
  }

  // Ná»™i dung + hiá»ƒn thá»‹
  inst.textContent = (v > 0 ? '+' : '') + v + ((v >= 4000) ? " ğŸ˜‡" :(v<=-4000)? " ğŸ˜ˆ":" ğŸ‘¤") ;
  if (inst._hideTimeout) { clearTimeout(inst._hideTimeout); inst._hideTimeout = null; }
  inst.style.opacity = '1';
  inst.style.display = 'block';

  // Äáº·t vá»‹ trÃ­ sau má»™t frame Ä‘á»ƒ inst.offsetWidth/offsetHeight cÃ³ giÃ¡ trá»‹ chÃ­nh xÃ¡c
  requestAnimationFrame(() => {
    const instW = inst.offsetWidth;
    const instH = inst.offsetHeight;

    const left = Math.round(targetRect.left + window.scrollX + Math.max(0, (targetRect.width - instW) / 2));
    const top  = Math.round(targetRect.top  + window.scrollY + Math.max(0, (targetRect.height - instH) / 2));

    inst.style.left = left + 'px';
    inst.style.top  = top  + 'px';
  });

  // áº¨n sau 700ms vá»›i fade
  inst._hideTimeout = setTimeout(()=> {
    inst.style.opacity = '0';
    setTimeout(()=> {
      inst.style.display = 'none';
      inst.style.opacity = '1'; // reset cho láº§n sau
    }, 250);
    inst._hideTimeout = null;
  }, 700);
  // ---------- Káº¾T THÃšC PHáº¦N HIá»‚N THá»Š ÄIá»‚M Tá»¨C THá»œI ----------

  // Giá»¯ nguyÃªn logic lÆ°u Ä‘iá»ƒm
  state.entries.push({ts:Date.now(),value:v});
  state.total += v;

  flashWhite();
  playBeep();
  slider.style.transition='top 0.25s ease';
  setTimeout(()=>slider.style.transition='',300);
}

function flashWhite() {
  LED.classList.remove('red','amber','green','pulse');
  LED.style.transition = 'none';
  LED.style.background = '#ffffff';

  // báº­t sÃ¡ng
  LED.style.opacity = '1';

  // táº¯t nhanh sau 120ms
  setTimeout(() => {
    LED.style.transition = 'opacity 0.15s';
    LED.style.opacity = '0.2';
  }, 120);

  // táº¯t hoÃ n toÃ n sau 250ms (trá»Ÿ vá» tráº¡ng thÃ¡i cÅ©)
  setTimeout(() => {
    LED_clear();
    LED.style.opacity = '1'; 
  }, 250);
}
// Countdown
function updateCountdown() {
  if (state.status !== 'running') {
    countdownEl.textContent = '--';
    return;
  }

  const now = Date.now();
  const rem = state.startTimestamp + MS_COUNTDOWN - now;

  // Háº¿t giá» â†’ giá»¯ nguyÃªn logic cÅ©
  if (rem <= 0) {
    finishCycle();
    return;
  }

  // --- Chuyá»ƒn Ä‘á»•i rem (ms) thÃ nh ngÃ y â€“ giá» â€“ phÃºt â€“ giÃ¢y ---
  let remaining = rem;

  const days = Math.floor(remaining / (24 * 60 * 60 * 1000));
  remaining %= 24 * 60 * 60 * 1000;

  const hours = Math.floor(remaining / (60 * 60 * 1000));
  remaining %= 60 * 60 * 1000;

  const minutes = Math.floor(remaining / (60 * 1000));
  const seconds = Math.floor((remaining % (60 * 1000)) / 1000);

  // --- Giá»¯ nguyÃªn cÃ¡ch update DOM, chá»‰ Ä‘á»•i format text ---
  countdownEl.textContent =
    `${days} ngÃ y ` +
    `${String(hours).padStart(2, '0')}:` +
    `${String(minutes).padStart(2, '0')}:` +
    `${String(seconds).padStart(2, '0')}`;
    saveCurrentCycle()
}

function finishCycle(){
    console.log("[finishCycle] start - state before finish:", state);

    // Set tráº¡ng thÃ¡i finished
    state.status = 'finished';

    // Chuáº©n bá»‹ Ã¢m thanh/LED nhÆ° cÅ©
    LED.classList.remove('red','amber','green','white');

    const sndAmber = document.getElementById('sndAmber');
    const sndRed   = document.getElementById('sndRed');
    const sndGreen = document.getElementById('sndGreen');

    if(state.total <= -4000){
        LED.className = 'led red led-red-alert';
        if (sndRed) { sndRed.currentTime = 0; sndRed.play(); }
    } else if(state.total >= 4000){
        LED.style.background='#f39c12';
        LED.classList.add('pulse');
        if (sndAmber) { sndAmber.currentTime = 0; sndAmber.play(); }
    } else {
        LED.style.background='#2ecc71';
        LED.classList.remove('pulse');
        if (sndGreen) { sndGreen.currentTime = 0; sndGreen.play(); }
    }

    totalEl.classList.remove('hidden');
    totalEl.textContent = (state.total>0?'+':'')+state.total;

    // Táº¡o báº£n ghi chu ká»³ hoÃ n chá»‰nh
    const finishedCycle = {
        cycleId: Date.now(),
        startTime: state.startTimestamp,
        endTime: Date.now(),
        totalScore: state.total,
        entries: state.entries ? state.entries.slice() : []
    };

    // Äáº£m báº£o luÃ´n cÃ³ máº£ng finishedCycles trong state
    if(!Array.isArray(state.finishedCycles)) state.finishedCycles = loadFinishedCycles() || [];

    // Push vÃ o memory vÃ  lÆ°u vÄ©nh viá»…n
    state.finishedCycles.unshift(finishedCycle);
    saveFinishedCycles(state.finishedCycles);

    console.log("[finishCycle] saved finishedCycles length =", state.finishedCycles.length);

    // XÃ³a chu ká»³ hiá»‡n táº¡i khá»i localStorage (Ä‘Ã£ back up vÃ o history)
    localStorage.removeItem(CURRENT_CYCLE_KEY);

    // Optionally reset current-cycle in memory to idle (giá»¯ history)
    state.status = 'idle';
    state.startTimestamp = null;
    state.entries = [];
    state.total = 0;
    saveCurrentCycle();
    document.getElementById('totalScore').style.display = 'block';
    // Má»Ÿ láº¡i Nháº­t kÃ½ (náº¡p láº¡i tá»« storage Ä‘á»ƒ cháº¯c cháº¯n nháº¥t) sau 100ms
   
}

// Start/reset
function startCycle(){
  state={status:'running', startTimestamp:Date.now(), entries:[], total:0};
  LED_clear();
  totalEl.textContent='0';
  totalEl.classList.add('hidden');
  placeSliderAtValue(0);
}

resetBtn.onclick = () => {

  // ---- Dá»ªNG NGAY Táº¤T Cáº¢ Ã‚M THANH ----
  const audios = ['sndAmber','sndRed','sndGreen'];
  audios.forEach(id => {
    const a = document.getElementById(id);
    if (a) {
      a.pause();
      a.currentTime = 0;
      // reload src Ä‘á»ƒ cÃ¡c trÃ¬nh duyá»‡t cháº¯c cháº¯n dá»«ng
      a.src = a.src;
    }
  });
  document.getElementById('totalScore').style.display = 'none';

  // ---- RESET BÃŒNH THÆ¯á»œNG ----
  startCycle();
};

const helpContent ='ğŸ¯ <strong>Äá»ŠNH NGHÄ¨A BA Táº¦NG TÃ‚M LÃ</strong>\n<strong>1) Báº¢N NÄ‚NG (Id)</strong> ğŸ”¥ â€“ Táº¦NG NÄ‚NG LÆ¯á»¢NG NGUYÃŠN THá»¦Y - ÄÃ”I KHI LÃ€ ÃC QUá»¶ ğŸ‘¿!\nId lÃ  pháº§n sÃ¢u nháº¥t vÃ  nguyÃªn thá»§y nháº¥t cá»§a con ngÆ°á»i:\nChá»©a cÃ¡c nhu cáº§u sinh há»c: Äƒn, ngá»§, sinh tá»“n ğŸ–ğŸ˜´\nChá»©a cÃ¡c cáº£m xÃºc thÃ´: giáº­n dá»¯, ham muá»‘n, chiáº¿m há»¯u ğŸ˜¡ğŸ”¥\nKhÃ´ng biáº¿t Ä‘Ãºng â€“ sai âš–ï¸\nKhÃ´ng biáº¿t Ä‘áº¡o Ä‘á»©c hay phÃ¡p luáº­t\nChá»‰ muá»‘n thá»a mÃ£n ngay láº­p tá»©c â©\nHoáº¡t Ä‘á»™ng theo NguyÃªn táº¯c KhoÃ¡i cáº£m ğŸ˜‹\nBáº£n nÄƒng lÃ  Ä‘á»™ng cÆ¡ thÃ´, máº¡nh máº½ nhÆ°ng thiáº¿u kiá»ƒm soÃ¡t.\nâ†’ Cáº§n Báº£n ngÃ£ Ä‘iá»u tiáº¿t vÃ  SiÃªu ngÃ£ Ä‘á»‹nh hÆ°á»›ng.\n\n<strong>2) Báº¢N NGÃƒ (Ego)</strong> ğŸ§ ğŸ¦°ğŸ‘¤\â€“ CON NGÆ¯á»œI THá»°C Táº¾\nBáº£n ngÃ£ hÃ¬nh thÃ nh Ä‘á»ƒ giÃºp con ngÆ°á»i thÃ­ch nghi vá»›i thá»±c táº¡i:\n- ÄÃ¡nh giÃ¡ háº­u quáº£, cÃ¢n nháº¯c trÆ°á»›c khi lÃ m ğŸ’¡\n- TÃ¬m cÃ¡ch thá»a mÃ£n Báº£n nÄƒng mÃ  khÃ´ng gÃ¢y ráº¯c rá»‘i\n- Nháº­n diá»‡n luáº­t lá»‡, giá»›i háº¡n, rá»§i ro ğŸŒ\n- Láº­p káº¿ hoáº¡ch â€“ tá»• chá»©c â€“ kiá»ƒm soÃ¡t hÃ nh vi ğŸ“…ğŸ•¹ï¸\nBáº£n ngÃ£ váº­n hÃ nh theo NguyÃªn táº¯c Hiá»‡n thá»±c.\nBáº£n ngÃ£ lÃ  bá»™ Ä‘iá»u phá»‘i trung tÃ¢m:\n- Giáº£m bá»›t yÃªu cáº§u bá»‘c Ä‘á»“ng cá»§a Báº£n nÄƒng\n- Giáº£m sá»± kháº¯t khe quÃ¡ má»©c cá»§a SiÃªu ngÃ£\n- Giá»¯ cho cÃ¡ nhÃ¢n sá»‘ng cÃ¢n báº±ng â€“ lÃ½ trÃ­ â€“ thá»±c táº¿\n\n<strong>3) SIÃŠU NGÃƒ (Superego)</strong> ğŸ•Šâ€“ Há»† THá»NG Äáº O Äá»¨C & LÃ TÆ¯á»NG - THIÃŠN THáº¦N ğŸ˜‡\nSiÃªu ngÃ£ Ä‘Æ°á»£c táº¡o nÃªn tá»«: giÃ¡o dá»¥c ğŸ“š, vÄƒn hÃ³a â€“ xÃ£ há»™i ğŸŒ, sá»± hÆ°á»›ng thiá»‡n â€“ mong muá»‘n trá»Ÿ nÃªn tá»‘t Ä‘áº¹p hÆ¡n ğŸ˜‡.\nNÃ³ váº­n hÃ nh theo NguyÃªn táº¯c Äáº¡o Ä‘á»©c/LÃ½ tÆ°á»Ÿng:\n- Äáº·t ra tiÃªu chuáº©n Ä‘Ãºng â€“ sai âš–ï¸\n- Táº¡o cáº£m giÃ¡c tá»™i lá»—i khi lÃ m sai ğŸ’”\n- Táº¡o cáº£m giÃ¡c tá»± hÃ o khi lÃ m Ä‘Ãºng ğŸŒˆ\n- LuÃ´n muá»‘n Ä‘áº¡t sá»± hoÃ n háº£o ğŸ†\nSiÃªu ngÃ£ lÃ  ngÆ°á»i giÃ¡m sÃ¡t ná»™i tÃ¢m:\nâ†’ Khuyáº¿n khÃ­ch Ä‘iá»u tá»‘t\nâ†’ NgÄƒn hÃ nh vi sai\nâ†’ NhÆ°ng Ä‘Ã´i khi khiáº¿n báº¡n nghiÃªm kháº¯c quÃ¡ má»©c vá»›i báº£n thÃ¢n\n\nğŸ“ <strong>3 NGUYÃŠN Táº®C Äá»‚ Gáº T THÆ¯á»šC ÄÃšNG</strong>\n1) Äá»˜NG CÆ  ğŸš€\nMá»¥c Ä‘Ã­ch tháº­t sá»± cá»§a báº¡n...?\nPhá»¥c vá»¥ báº£n thÃ¢n hay ngÆ°á»i khÃ¡c...?\nXuáº¥t phÃ¡t tá»« cáº£m xÃºc hay lÃ½ trÃ­...?\n\n2) Báº¢N CHáº¤T KHÃCH QUAN ğŸ§\nTheo phÃ¡p luáº­t â€“ vÄƒn hÃ³a â€“ Ä‘áº¡o Ä‘á»©c - xÃ£ há»™i hiá»‡n táº¡i, hÃ nh vi Ä‘Ã³ gÃ¢y háº¡i hay gÃ¢y lá»£i...?\nHáº­u quáº£ náº·ng hay nháº¹...?\n\n3) Äá»’NG Cáº¢M ğŸ¤\nNgÆ°á»i khÃ¡c sáº½ cáº£m tháº¥y gÃ¬ khi báº¡n lÃ m nhÆ° váº­y?\nTÃ¡c Ä‘á»™ng nháº¥t thá»i hay dÃ i háº¡n...?\nâ¡ï¸ Vá»›i má»—i nguyÃªn táº¯c, náº¿u hÃ nh vi khuynh hÆ°á»›ng bÃªn nÃ o thÃ¬ gáº¡t vá» bÃªn Ä‘Ã³ má»™t Ä‘oáº¡n. Vá»‹ trÃ­ cuá»‘i cÃ¹ng cá»§a thanh gáº¡t = káº¿t quáº£ sau khi gáº¡t dá»“n vÆ°á»£t qua 3 nguyÃªn táº¯c.\n\nğŸ§­ <strong>KHI NÃ€O NÃŠN DÃ™NG â€“ KHI NÃ€O KHÃ”NG NÃŠN DÃ™NG</strong>\nâœ… DÃ™NG KHI hÃ nh vi cÃ³: Cáº£m xÃºc, nháº­n thá»©c, liÃªn quan Ä‘áº¡o Ä‘á»©c, cÃ³ lá»±a chá»n, tÃ¡c Ä‘á»™ng Ä‘áº¿n ngÆ°á»i khÃ¡c, cÃ³ xung Ä‘á»™t ná»™i tÃ¢m, Ä‘áº¥u tranh giá»¯a báº£n nÄƒng - lÃ½ trÃ­ vÃ  Ä‘áº¡o Ä‘á»©c, cÃ³ Ã½ thá»©c rÃµ rÃ ng\nVÃ­ dá»¥: Quyáº¿t Ä‘á»‹nh nÃ³i tháº­t hay nÃ³i dá»‘i, tha thá»© hay tráº£ Ä‘Å©a, chia sáº» hay giá»¯ lá»£i Ã­ch cho mÃ¬nh, nÃ³i lá»i tá»­ táº¿ hay lá»i lÃ m tá»•n thÆ°Æ¡ngâ€¦\n\nâŒ KHÃ”NG DÃ™NG KHI:\n1) Pháº£n xáº¡ sinh há»c: giáº­t mÃ¬nh, nÃ© váº­t, co tay khi nÃ³ng...\n2) CÃ´ng viá»‡c ká»¹ thuáº­t â€“ logic thuáº§n tÃºy: giáº£i toÃ¡n, viáº¿t code, nghiÃªn cá»©u khoa há»c\n3) ThÃ³i quen vÃ´ thá»©c: Ä‘Ã¡nh rÄƒng, táº¯m, lÆ°á»›t máº¡ng xÃ£ há»™i theo pháº£n xáº¡...\n4) HÃ nh vi táº­p thá»ƒ â€“ xÃ£ há»™i há»c: nghi lá»… tÃ´n giÃ¡o, biá»ƒu tÃ¬nh, báº§u cá»­, máº·c Ä‘á»“ng phá»¥c...\n5) HÃ nh vi siÃªu thá»©c / ngoÃ i thá»i gian â€“ khÃ´ng gian: thiá»n sÃ¢u, sÃ¡ng táº¡o Ä‘áº¿n quÃªn mÃ¬nh, giÃ¡c ngá»™, cáº­n tá»­...\n6) NgÆ°á»i máº¥t kháº£ nÄƒng tá»± chá»§: loáº¡n tháº§n, hoang tÆ°á»Ÿng, say rÆ°á»£u áº£o giÃ¡c, Ä‘á»™ng kinh...\n\nğŸ” <strong>Lá»°A CHá»ŒN Gáº T TRÆ¯á»šC HAY SAU HÃ€NH VI</strong>\nGáº¡t trÆ°á»›c khi lÃ m:\nâ†’ GiÃºp báº¡n cÃ¢n nháº¯c ká»¹ háº­u quáº£\nâ†’ Giáº£m hÃ nh vi bá»‘c Ä‘á»“ng\nGáº¡t sau khi lÃ m:\nâ†’ GiÃºp báº¡n hiá»ƒu mÃ¬nh hÆ¡n\nâ†’ TÄƒng kháº£ nÄƒng tá»± Ä‘Ã¡nh giÃ¡\n\nâ“ <strong>Náº¾U KHÃ”NG XÃC Äá»ŠNH ÄÆ¯á»¢C 1 NGUYÃŠN Táº®C?</strong>\nVÃ­ dá»¥: ChÆ°a rÃµ Ä‘á»™ng cÆ¡, khÃ´ng biáº¿t luáº­t, khÃ´ng nghÄ© Ä‘Æ°á»£c Ä‘áº¿n cáº£m xÃºc ngÆ°á»i khÃ¡c...\nâ¡ï¸ KhÃ´ng gáº¡t nguyÃªn táº¯c Ä‘Ã³\nhoáº·c\nâ¡ï¸ Nháº¹ nhÃ ng gáº¡t vá» phÃ­a Báº£n nÄƒng (Id)\n(vÃ¬ thiáº¿u thÃ´ng tin â†’ dá»… sai, cÃ³ thá»ƒ dáº«n Ä‘áº¿n háº­u quáº£ xáº¥u)\n\nğŸšï¸ <strong>CÃCH THá»¨C GHI NHáº¬N XU HÆ¯á»šNG TÃ‚M LÃ</strong>\nGáº¡t vá» phÃ­a Báº£n nÄƒng (Id) â†’ Äiá»ƒm Ã¢m ğŸ’”\nâ†’ HÃ nh vi thiÃªn vá» cáº£m xÃºc thÃ´ â€“ thiáº¿u cÃ¢n nháº¯c\nGáº¡t vá» phÃ­a SiÃªu ngÃ£ (Superego) â†’ Äiá»ƒm dÆ°Æ¡ng â¤ï¸\nâ†’ HÃ nh vi thiÃªn vá» Ä‘áº¡o Ä‘á»©c â€“ chuáº©n má»±c â€“ trÃ¡ch nhiá»‡m\nCÃ ng sÃ¡t hai cá»±c â†’ má»©c Ä‘á»™ cÃ ng máº¡nh \n\nâš™ï¸ <strong>Cáº¤U HÃŒNH BAN Äáº¦U (KHI RESET)</strong>\nThanh gáº¡t Ä‘áº·t á»Ÿ chÃ­nh giá»¯a â†’ tÆ°á»£ng trÆ°ng cho Ego â€“ tráº¡ng thÃ¡i cÃ¢n báº±ng âš–ï¸\nTá»•ng Ä‘iá»ƒm = 0 ğŸ¯\nÄÃ¨n vÃ  Ã¢m thanh táº¯t ğŸ”•\n\nğŸ§  <strong>XÃC NHáº¬N ÄIá»‚M</strong>\nKhi áº¥n xuá»‘ng trÃªn thanh gáº¡t:\nHá»‡ thá»‘ng lÆ°u láº¡i Ä‘iá»ƒm ğŸ—ƒï¸\nÄÃ¨n sÃ¡ng tráº¯ng ğŸ¤\nPhÃ¡t tiáº¿ng bÃ­p nháº¹ ğŸ”Š\nâ†’ BÃ¡o hiá»‡u: ghi Ä‘iá»ƒm thÃ nh cÃ´ng ğŸ‰\nSau khi gáº¡t vÃ  tÃ­ch Ä‘iá»ƒm xong má»™t láº§n, nháº¥n nÃºt <b>Há»“i vá»‹</b> Ä‘á»ƒ Ä‘Æ°a thanh gáº¡t vá» vá»‹ trÃ­ gá»‘c chÃ­nh giá»¯a ban Ä‘áº§u, chuáº©n bá»‹ cho láº§n gáº¡t tiáº¿p theo.\n\nâ³ <strong>CHU Ká»² PHáº¢N TÆ¯ 168 GIá»œ (7 NGÃ€Y)</strong>\nSau khi xÃ¡c nháº­n Ä‘iá»ƒm Ä‘áº§u tiÃªn â†’ Ä‘á»“ng há»“ báº¯t Ä‘áº§u Ä‘áº¿m 168 giá»\nTrong 7 ngÃ y:\nGáº¡t thÆ°á»›c khÃ´ng giá»›i háº¡n sá»‘ láº§n\nMá»—i láº§n nháº¥n â†’ Ä‘iá»ƒm cá»™ng vÃ o tá»•ng Ä‘iá»ƒm ğŸ“Š\n\nğŸ“£ <strong>BÃO Káº¾T QUáº¢ SAU 168 GIá»œ</strong>\nğŸŸ  â‰¥ +4000 â†’ SiÃªu ngÃ£ máº¡nh\nÄÃ¨n cam nháº¥p nhÃ¡y ğŸŸ \nÃ‚m thanh cáº£nh bÃ¡o âš ï¸\nâ†’ QuÃ¡ Ä‘áº¡o Ä‘á»©c â†’ dá»… hy sinh báº£n thÃ¢n quÃ¡ má»©c\nğŸ”´ â‰¤ â€“4000 â†’ Báº£n nÄƒng máº¡nh\nÄÃ¨n Ä‘á» nháº¥p nhÃ¡y ğŸ”´\nÃ‚m thanh cáº£nh bÃ¡o âš ï¸\nâ†’ ThiÃªn vá» cáº£m xÃºc â€“ bá»‘c Ä‘á»“ng â€“ thiáº¿u cÃ¢n nháº¯c ngÆ°á»i khÃ¡c\nğŸŸ¢ â€“3999 Ä‘áº¿n +3999 â†’ CÃ¢n báº±ng Ä‘Ã´i bÃªn\nÄÃ¨n xanh tÄ©nh ğŸŸ¢\nÃ‚m thanh chÃºc má»«ng ğŸ‰\nâ†’ Sá»‘ng hÃ i hÃ²a giá»¯a lá»£i Ã­ch báº£n thÃ¢n & cá»™ng Ä‘á»“ng ğŸŒˆ. ÄÃ¢y cÅ©ng chÃ­nh lÃ  má»¥c tiÃªu tá»‘i thÆ°á»£ng, cao cáº£ vÃ  nhÃ¢n vÄƒn cá»§a cÃ¢y thÆ°á»›c khi Ä‘áº¿n vá»›i ngÆ°á»i dÃ¹ng.\n\nğŸ“…â¡ï¸ğŸ§  <strong>THEO DÃ•I LÃ‚U DÃ€I</strong>\nNgÆ°á»i dÃ¹ng cÃ³ thá»ƒ quan sÃ¡t qua <strong>Nháº­t kÃ½</strong>:\n- Má»©c Ä‘á»™ á»•n Ä‘á»‹nh cáº£m xÃºc\n- Sá»± thay Ä‘á»•i hÃ nh vi, tÃ¢m lÃ½, nhÃ¢n cÃ¡ch\n- Xu hÆ°á»›ng nghiÃªng vá» bÃªn nÃ o nhiá»u hÆ¡n\n- Kháº£ nÄƒng kiá»ƒm soÃ¡t báº£n thÃ¢n\n-> ÄÃ¢y lÃ  quÃ¡ trÃ¬nh phÃ¡t triá»ƒn nhÃ¢n cÃ¡ch bá»n vá»¯ng.\n\nâš ï¸ <strong>Cáº¢NH BÃO & LÆ¯U Ã QUAN TRá»ŒNG</strong>\n1. KhÃ´ng pháº£i cÃ´ng cá»¥ cháº©n Ä‘oÃ¡n y táº¿ / tÃ¢m lÃ½ ğŸ§ªğŸš«\nThÆ°á»›c Ä‘Æ°á»£c thiáº¿t káº¿ dá»±a trÃªn thuyáº¿t PhÃ¢n tÃ¢m há»c - vá»‘n mang tÃ­nh triáº¿t há»c nhiá»u hÆ¡n khoa há»c hiá»‡n Ä‘áº¡i (chÆ°a Ä‘Æ°á»£c kiá»ƒm chá»©ng, thiáº¿u cÆ¡ sá»Ÿ khoa há»c, mang tÃ­nh chá»§ quan cao, thiáº¿u tÃ­nh phá»• quÃ¡t), chá»‰ Ä‘Ã³ng vai trÃ² lÃ  cÃ´ng cá»¥ giÃ¡o dá»¥c tá»± pháº£n tÆ° báº£n thÃ¢n vá» nhá»¯ng xung Ä‘á»™t trong lá»£i Ã­ch, khÃ´ng pháº£i thiáº¿t bá»‹ cháº©n Ä‘oÃ¡n chÃ­nh xÃ¡c tuyá»‡t Ä‘á»‘i tÃ¢m lÃ½ con ngÆ°á»i.\nKhÃ´ng dÃ¹ng káº¿t quáº£ Ä‘á»ƒ thay tháº¿ cháº©n Ä‘oÃ¡n, tÆ° váº¥n hay trá»‹ liá»‡u chuyÃªn mÃ´n (bÃ¡c sÄ©, nhÃ  tÃ¢m lÃ½, bÃ¡c sÄ© tÃ¢m tháº§n).\nNáº¿u báº¡n hoáº·c ngÆ°á»i thÃ¢n cÃ³ dáº¥u hiá»‡u nghiÃªm trá»ng (tá»± háº¡i, Ã½ Ä‘á»‹nh gÃ¢y háº¡i ngÆ°á»i khÃ¡c, hoang tÆ°á»Ÿng, máº¥t liÃªn há»‡ vá»›i thá»±c táº¡i), ngay láº­p tá»©c tÃ¬m trá»£ giÃºp chuyÃªn nghiá»‡p.\n\n2. Trung thá»±c khi sá»­ dá»¥ng â€” yáº¿u tá»‘ then chá»‘t ğŸ”ğŸ§­\nKáº¿t quáº£ mang tÃ­nh chá»§ quan cao, phá»¥ thuá»™c hoÃ n toÃ n vÃ o cÃ¡ch báº¡n kÃ©o gáº¡t vÃ  cÃ¡ch báº¡n tá»± Ä‘Ã¡nh giÃ¡ theo 3 nguyÃªn táº¯c.\nTrung thá»±c tuyá»‡t Ä‘á»‘i vá»›i chÃ­nh mÃ¬nh khi tráº£ lá»i (Ä‘á»™ng cÆ¡, khÃ¡ch quan, Ä‘á»“ng cáº£m) lÃ  Ä‘iá»u cáº§n thiáº¿t.\nNáº¿u cá»‘ tÃ¬nh thao tÃ¡c khÃ´ng tháº­t (Ä‘á»ƒ "Ä‘Æ°á»£c Ä‘iá»ƒm" hoáº·c Ä‘á»ƒ kiá»ƒm tra thiáº¿t bá»‹), káº¿t quáº£ sáº½ máº¥t Ã½ nghÄ©a vÃ  cÃ³ thá»ƒ dáº«n Ä‘áº¿n hiá»ƒu sai vá» báº£n thÃ¢n.\n\n3. Äiá»ƒm sá»‘ khÃ´ng báº±ng nhÃ¢n cÃ¡ch con ngÆ°á»i ğŸ«¶\nMá»™t hay nhiá»u láº§n Ä‘iá»ƒm Ã¢m/dÆ°Æ¡ng khÃ´ng biáº¿n báº¡n thÃ nh â€œxáº¥uâ€ hay â€œthÃ¡nh thiá»‡nâ€.\nÄiá»ƒm chá»‰ nÃ³i lÃªn xu hÆ°á»›ng má»™t cÃ¡ch tÆ°Æ¡ng Ä‘á»‘i sau 7 ngÃ y tá»•ng káº¿t, khÃ´ng Ä‘Ã¡nh giÃ¡ giÃ¡ trá»‹ con ngÆ°á»i.\nHÃ£y Ä‘á»c Ä‘iá»ƒm nhÆ° chá»‰ sá»‘ tham kháº£o â€” báº¯t Ä‘áº§u cuá»™c Ä‘á»‘i thoáº¡i vá»›i chÃ­nh mÃ¬nh, khÃ´ng tá»± buá»™c tá»™i.\n\n4. KhÃ´ng dÃ¹ng thÆ°á»›c Ä‘á»ƒ phÃ¡n xÃ©t ngÆ°á»i khÃ¡c hoáº·c lÃ m báº±ng chá»©ng phÃ¡p lÃ½ âš–ï¸âœ‹\nTuyá»‡t Ä‘á»‘i khÃ´ng dÃ¹ng thÆ°á»›c lÃ m cÃ´ng cá»¥ Ä‘Ã¡nh giÃ¡, káº¿t luáº­n, xÃºc pháº¡m hoáº·c xá»­ lÃ½ ngÆ°á»i khÃ¡c (gia Ä‘Ã¬nh, Ä‘á»“ng nghiá»‡p, há»c sinhâ€¦).\nKhÃ´ng dÃ¹ng káº¿t quáº£ lÃ m báº±ng chá»©ng trong cÃ¡c tranh cháº¥p, tá»‘ tá»¥ng, quyáº¿t Ä‘á»‹nh tuyá»ƒn chá»n, sa tháº£i, ká»· luáº­t hoáº·c cÃ¡c váº¥n Ä‘á» phÃ¡p lÃ½.\n\n5. TrÃ¡nh dÃ¹ng trong tráº¡ng thÃ¡i cáº£m xÃºc cá»±c Ä‘á»™ hoáº·c máº¥t kiá»ƒm soÃ¡t ğŸŒ€\nKhÃ´ng dÃ¹ng khi: say rÆ°á»£u, bá»‹ kÃ­ch Ä‘á»™ng máº¡nh, hoáº£ng loáº¡n, Ä‘ang trong cÆ¡n khá»§ng hoáº£ng, máº¥t ngá»§ náº·ng, dÃ¹ng cháº¥t kÃ­ch thÃ­ch.\nNhá»¯ng tráº¡ng thÃ¡i nÃ y lÃ m mÃ©o mÃ³ nháº­n thá»©c â†’ káº¿t quáº£ sai lá»‡ch, Ä‘Ã´i khi gÃ¢y háº­u quáº£ cáº£m xÃºc xáº¥u cho báº¡n.\n\n6. NhÃ³m ngÆ°á»i khÃ´ng phÃ¹ há»£p hoáº·c cáº§n tháº­n trá»ng Ä‘áº·c biá»‡t âš ï¸\nNgÆ°á»i cÃ³ rá»‘i loáº¡n tháº§n kinh náº·ng, rá»‘i loáº¡n nhÃ¢n cÃ¡ch náº·ng, rá»‘i loáº¡n tÃ¢m tháº§n, áº£o giÃ¡c, Ä‘á»™ng kinh cáº§n khÃ´ng dÃ¹ng thÆ°á»›c Ä‘á»ƒ tá»± Ä‘Ã¡nh giÃ¡.\nTráº» em dÆ°á»›i Ä‘á»™ tuá»•i trÆ°á»Ÿng thÃ nh: chá»‰ dÃ¹ng dÆ°á»›i sá»± giÃ¡m sÃ¡t vÃ  giáº£i thÃ­ch cá»§a ngÆ°á»i lá»›n/giÃ¡o viÃªn/chuyÃªn gia.\nNgÆ°á»i Ä‘ang trong quÃ¡ trÃ¬nh Ä‘iá»u trá»‹ tÃ¢m lÃ½/thuá»‘c cáº§n há»i Ã½ kiáº¿n chuyÃªn gia trÆ°á»›c khi dÃ¹ng.\n\n7. Nguy cÆ¡ lá»‡ thuá»™c & tá»± phÃ¡n xÃ©t â€” dÃ¹ng thÆ°á»›c cÃ³ trÃ¡ch nhiá»‡m ğŸ§­\nKhÃ´ng nÃªn dÃ¹ng thÆ°á»›c lÃ m bÃ¡o cÃ¡o giÃ¡ trá»‹ báº£n thÃ¢n hÃ ng ngÃ y; náº¿u láº¡m dá»¥ng sáº½ táº¡o thÃ³i quen so sÃ¡nh vÃ  lá»‡ thuá»™c vÃ o chá»‰ sá»‘.\nTrÃ¡nh chuyá»ƒn viá»‡c â€œlÃ m tá»‘t/khÃ´ng tá»‘tâ€ thÃ nh Ã¡p lá»±c: con ngÆ°á»i phÃ¡t triá»ƒn báº±ng táº­p luyá»‡n & bá»‘i cáº£nh, khÃ´ng pháº£i chá»‰ sá»‘.\n\n8. Quyá»n riÃªng tÆ° & dá»¯ liá»‡u cÃ¡ nhÃ¢n ğŸ”\nCáº§n minh báº¡ch vá» viá»‡c lÆ°u trá»¯, ai cÃ³ thá»ƒ truy cáº­p, thá»i gian lÆ°u vÃ  xÃ³a dá»¯ liá»‡u.\nKhÃ´ng chia sáº» káº¿t quáº£ vá»›i ngÆ°á»i khÃ¡c náº¿u báº¡n chÆ°a sáºµn sÃ ng hoáº·c chÆ°a thÃ´ng bÃ¡o rÃµ má»¥c Ä‘Ã­ch.\n\n9. CÃ¡ch pháº£n á»©ng khi káº¿t quáº£ cáº£nh bÃ¡o (Ä‘á»/cam) ğŸš¨\nÄá»«ng hoáº£ng loáº¡n â€” coi Ä‘Ã³ lÃ  tÃ­n hiá»‡u Ä‘á»ƒ dá»«ng, suy nghÄ© vÃ  hÃ nh Ä‘á»™ng cÃ³ trÃ¡ch nhiá»‡m.\nLÃ m ngay: dá»«ng hÃ nh Ä‘á»™ng, hÃ­t thá»Ÿ, ghi nháº­t kÃ½ ngáº¯n, tÃ¬m ngÆ°á»i tin cáº­y Ä‘á»ƒ trÃ² chuyá»‡n.\nNáº¿u káº¿t quáº£ láº·p láº¡i liÃªn tá»¥c vÃ  báº¡n cáº£m tháº¥y khÃ³ kiá»ƒm soÃ¡t hÃ nh vi â†’ tÃ¬m chuyÃªn gia tÃ¢m lÃ½ Ä‘á»ƒ Ä‘Æ°á»£c há»— trá»£.\n\n10. LÆ°u Ã½ vÄƒn hÃ³a & bá»‘i cáº£nh xÃ£ há»™i ğŸŒ\nHÃ nh vi Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ khÃ¡c nhau theo vÄƒn hÃ³a, luáº­t phÃ¡p vÃ  bá»‘i cáº£nh.\nKhi di chuyá»ƒn giá»¯a ná»n vÄƒn hÃ³a hoáº·c sá»‘ng á»Ÿ nÆ°á»›c khÃ¡c, khÃ´ng dÃ¹ng thÆ°á»›c nhÆ° má»™t tiÃªu chuáº©n tuyá»‡t Ä‘á»‘i mÃ  cáº§n tham kháº£o vÄƒn hoÃ¡/luáº­t Ä‘á»‹a phÆ°Æ¡ng.\n\n11. Khi nÃ o cáº§n tÃ¬m giÃºp Ä‘á»¡ chuyÃªn nghiá»‡p â˜ï¸\nBáº¡n cÃ³ xu hÆ°á»›ng tá»± lÃ m háº¡i hoáº·c nghÄ© ngÆ°á»i khÃ¡c sáº½ bá»‹ tá»•n thÆ°Æ¡ng.\nKáº¿t quáº£ thÆ°á»›c gÃ¢y cáº£m xÃºc tiÃªu cá»±c kÃ©o dÃ i (suy sá»¥p, tráº§m cáº£m).\nMáº¥t kháº£ nÄƒng lÃ m viá»‡c, há»c táº­p hoáº·c duy trÃ¬ cÃ¡c má»‘i quan há»‡ vÃ¬ hÃ nh vi.\nâ†’ LiÃªn há»‡ bÃ¡c sÄ© tÃ¢m tháº§n / nhÃ  trá»‹ liá»‡u / Ä‘Æ°á»ng dÃ¢y nÃ³ng kháº©n cáº¥p.\n\nğŸ’¬ <strong>Lá»œI NHáº®C CUá»I</strong>\n> â€œThÆ°á»›c khÃ´ng dÃ¹ng Ä‘á»ƒ phÃ¡n xÃ©t â€“ mÃ  Ä‘á»ƒ pháº£n tÆ°.â€\nHÃ£y dÃ¹ng nÃ³ nhÆ° gÆ°Æ¡ng soi ná»™i tÃ¢m Ä‘á»ƒ sá»‘ng tá»‰nh thá»©c hÆ¡n má»—i ngÃ y.\n';

helpBtn.onclick = () => {
  document.getElementById('helpText').innerHTML = helpContent;
  document.getElementById('helpModal').style.display = 'block';
};


document.getElementById('closeHelp').onclick = () => {
  document.getElementById('helpModal').style.display = 'none';
};

initSlider();
setInterval(updateCountdown,200);
updateCountdown();


function revertSlider() {
  placeSliderAtValue(0);
}
document.getElementById('revBtn').onclick = revertSlider;
function formatFullTime(ts) {
  const d = new Date(ts);
  return d.toLocaleString('vi-VN', { hour12: false }); 
}

function interpretLevel(v) {
  if (v >= 4000) return "â†’ SiÃªu ngÃ£ ğŸ˜‡";
  if (v <= -4000) return "â†’ Báº£n nÄƒng ğŸ˜ˆ";
  return "â†’ Báº£n ngÃ£ ğŸ‘¤";
}

function formatDateTime(ts) {
    const d = new Date(ts);
    const date = d.toLocaleDateString('vi-VN');
    const time = d.toLocaleTimeString('vi-VN', { hour12: false });
    return { date, time };
}

function interpretScore(score) {
    if (score >= 4000) return "SiÃªu ngÃ£ máº¡nh ğŸ˜‡";
    if (score <= -4000) return "Báº£n nÄƒng máº¡nh ğŸ˜ˆ";
    return "Báº£n ngÃ£ cÃ¢n báº±ng âœ…";
}

// ThÃªm chá»©c nÄƒng XÃ“A Lá»ŠCH Sá»¬ VÄ¨NH VIá»„N
function clearHistory() {
    if (confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a TOÃ€N Bá»˜ lá»‹ch sá»­ cÃ¡c chu ká»³ Ä‘Ã£ hoÃ n thÃ nh? HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c.")) {
        state.finishedCycles = [];
        saveFinishedCycles([]); // XÃ³a khá»i localStorage
        showReview(); // Cáº­p nháº­t láº¡i mÃ n hÃ¬nh Nháº­t kÃ½
        alert("Lá»‹ch sá»­ chu ká»³ Ä‘Ã£ Ä‘Æ°á»£c xÃ³a vÄ©nh viá»…n.");
    }
}

function showReview() {
    // Táº£i láº¡i lá»‹ch sá»­ tá»« storage Ä‘á»ƒ Ä‘áº£m báº£o luÃ´n cáº­p nháº­t
    state.finishedCycles = loadFinishedCycles() || [];

    const box = document.getElementById('reviewContent');
    document.getElementById('reviewModal').style.display = 'block';

    // Náº¿u Ä‘ang cháº¡y, show thÃ´ng tin chu ká»³ hiá»‡n táº¡i lÃªn Ä‘áº§u
    let html = '';
    if (state.status === 'running') {
        html +=
            "<h3>â³ Chu ká»³ hiá»‡n táº¡i Ä‘ang diá»…n ra</h3>" +
            "<p>Chu ká»³ hiá»‡n táº¡i (báº¯t Ä‘áº§u tá»« " + (state.startTimestamp ? formatDateTime(state.startTimestamp).date : 'â€”') + ") sáº½ Ä‘Æ°á»£c lÆ°u vÃ o lá»‹ch sá»­ khi Ä‘á»“ng há»“ Ä‘áº¿m ngÆ°á»£c káº¿t thÃºc.</p>" +
            "<p>Tá»•ng Ä‘iá»ƒm hiá»‡n táº¡i: " + (state.total > 0 ? '+' : '') + state.total + "</p>";
    }

    // Náº¿u khÃ´ng cÃ³ lá»‹ch sá»­ nÃ o
    if (!state.finishedCycles || state.finishedCycles.length === 0) {
        if (state.status !== 'running') {
            html += "<h3>ğŸ“œ Nháº­t kÃ½ Chu ká»³</h3><p>KhÃ´ng cÃ³ chu ká»³ nÃ o Ä‘Ã£ hoÃ n thÃ nh Ä‘Æ°á»£c lÆ°u.</p>";
        }
        box.innerHTML = html;
        return;
    }

    // === Báº£ng tá»•ng káº¿t (oldest -> newest, Chu ká»³ #1 = oldest) ===
    html += "<h3>ğŸ“œ Lá»‹ch sá»­ cÃ¡c Chu ká»³ Ä‘Ã£ HoÃ n thÃ nh</h3>";
    html += "<table border='1' style='width:100%; border-collapse:collapse; margin-top:12px; font-size:14px;'>";
    html += "<thead><tr>" +
            "<th style='padding:8px; background:#004080; color:#fff;'>Chu ká»³</th>" +
            "<th style='padding:8px; background:#004080; color:#fff;'>Tá»•ng Äiá»ƒm</th>" +
            "<th style='padding:8px; background:#004080; color:#fff;'>Khuynh HÆ°á»›ng</th>" +
            "<th style='padding:8px; background:#004080; color:#fff;'>Thá»i gian Báº¯t Ä‘áº§u</th>" +
            "<th style='padding:8px; background:#004080; color:#fff;'>Láº§n Gáº¡t</th>" +
            "</tr></thead><tbody>";

    // state.finishedCycles[0] lÃ  má»›i nháº¥t (do unshift). Duyá»‡t tá»« end -> 0 Ä‘á»ƒ hiá»ƒn thá»‹ oldest -> newest
    for (let i = state.finishedCycles.length - 1; i >= 0; i--) {
        const cycle = state.finishedCycles[i];
        const start = formatDateTime(cycle.startTime);
        const cycleNum = state.finishedCycles.length - i; // 1..n, 1 = oldest
        const trend = interpretScore(cycle.totalScore);
        const scoreStyle = cycle.totalScore > 3999 ? 'color:orange; font-weight:bold;' :
                   cycle.totalScore < -3999 ? 'color:red; font-weight:bold;' :
                   'color:green; font-weight:bold;';

        html += `<tr>` +
                `<td style='padding:6px; text-align:center;'>${cycleNum}</td>` +
                `<td style='padding:6px; text-align:center; ${scoreStyle}'>${cycle.totalScore > 0 ? '+' : ''}${cycle.totalScore}</td>` +
                `<td style='padding:6px;'>${trend}</td>` +
                `<td style='padding:6px;'> ${start.time} ${start.date}</td>` +
                `<td style='padding:6px; text-align:center;'>${Array.isArray(cycle.entries) ? cycle.entries.length : 0}</td>` +
                `</tr>`;
    }

    html += "</tbody></table>";

    // NÃºt xÃ³a lá»‹ch sá»­
    html += '<div style="margin-top:12px;"><button id="clearHistoryBtn" class="btn warn">XÃ³a toÃ n bá»™ Nháº­t kÃ½</button></div>';

    // Container cho cÃ¡c báº£ng chi tiáº¿t tá»«ng chu ká»³ (sáº½ chÃ¨n n báº£ng á»Ÿ Ä‘Ã¢y)
    html += '<div id="cycleDetailsContainer" style="margin-top:18px;"></div>';

    // GÃ¡n HTML táº¡m
    box.innerHTML = html;

    // Hook nÃºt xÃ³a
    document.getElementById('clearHistoryBtn').onclick = clearHistory;

    // === Táº O CÃC Báº¢NG CHI TIáº¾T ===
    const detailsContainer = document.getElementById('cycleDetailsContainer');

    // Duyá»‡t láº¡i theo cÃ¹ng thá»© tá»± (oldest -> newest)
    for (let i = state.finishedCycles.length - 1; i >= 0; i--) {
        const cycle = state.finishedCycles[i];
        const cycleNum = state.finishedCycles.length - i; // Chu ká»³ # theo same numbering
        const startObj = formatDateTime(cycle.startTime);
        const header = `<h4 style="margin-top:14px; margin-bottom:6px;">ğŸ” Chi tiáº¿t Chu ká»³ ${cycleNum} â€” Báº¯t Ä‘áº§u: ${startObj.time} ${startObj.date} â€” Tá»•ng: ${cycle.totalScore > 0 ? '+' : ''}${cycle.totalScore}</h4>`;

        let t = `<div style="border:1px solid #e6eef8; padding:8px; border-radius:8px; margin-bottom:12px;">`;
        t += header;
        t += `<table border='1' style='width:100%; border-collapse:collapse; font-size:13px;'>`;
        t += `<thead><tr>
                <th style='padding:6px; background:#f0f6fb;'>Gáº¡t</th>
                <th style='padding:6px; background:#f0f6fb;'>Äiá»ƒm</th>
                <th style='padding:6px; background:#f0f6fb;'>Khuynh HÆ°á»›ng</th>
                <th style='padding:6px; background:#f0f6fb;'>Giá»</th>
                <th style='padding:6px; background:#f0f6fb;'>NgÃ y</th>
               </tr></thead><tbody>`;

        const entries = Array.isArray(cycle.entries) ? cycle.entries : [];
        if (entries.length === 0) {
            t += `<tr><td colspan="5" style="padding:8px; text-align:center; color:#666">KhÃ´ng cÃ³ láº§n gáº¡t nÃ o Ä‘Æ°á»£c lÆ°u trong chu ká»³ nÃ y.</td></tr>`;
        } else {
            // Hiá»ƒn thá»‹ entries theo thá»© tá»± lÆ°u (thÆ°á»ng lÃ  chronological order). Náº¿u muá»‘n Ä‘áº£o, cÃ³ thá»ƒ Ä‘á»•i loop.
            for (let j = 0; j < entries.length; j++) {
                const e = entries[j];
                const val = (typeof e.value === 'number') ? e.value : (e.value ? Number(e.value) : 0);
                const signVal = (val > 0 ? '+' : '') + val;
                const dir = e.dir || (val > 3999 ? 'SiÃªu NgÃ£ ğŸ•Š' : val < -3999 ? 'Báº£n NÄƒng ğŸ˜‹' : 'Báº£n NgÃ£ ğŸ‘¤');

                let timeStr = '', dateStr = '';
                if (e.time && e.date) {
                    timeStr = e.time; dateStr = e.date;
                } else if (e.ts) {
                    const ft = formatDateTime(e.ts);
                    timeStr = ft.time; dateStr = ft.date;
                } else {
                    const ft = formatDateTime(Date.now());
                    timeStr = ft.time; dateStr = ft.date;
                }

                t += `<tr>
                        <td style='padding:6px; text-align:center;'>${j+1}</td>
                        <td style='padding:6px; text-align:center;'>${signVal}</td>
                        <td style='padding:6px; text-align:center;'>${dir}</td>
                        <td style='padding:6px; text-align:center;'>${timeStr}</td>
                        <td style='padding:6px; text-align:center;'>${dateStr}</td>
                      </tr>`;
            }
        }

        t += `</tbody></table></div>`;

        detailsContainer.insertAdjacentHTML('beforeend', t);
    }
}



document.getElementById('closeReview').onclick = () => {
  document.getElementById('reviewModal').style.display = 'none';
};

document.getElementById('reviewBtn').onclick = showReview;
// Ã‚m click nÃºt
const btnClickSound = new Audio("click.mp3");
btnClickSound.volume = 0.35; // chá»‰nh Ä‘á»™ lá»›n táº¡i Ä‘Ã¢y

function playBtnSound() {
    // reset vá» Ä‘áº§u, trÃ¡nh bá»‹ delay
    btnClickSound.currentTime = 0;
    btnClickSound.play().catch(()=>{});
}
// HÃ€M Má» KHÃ“A Ã‚M THANH CHO THIáº¾T Bá»Š DI Äá»˜NG
let audioUnlocked = false;

function unlockAudio() {
    if (audioUnlocked) return;
    
    // Danh sÃ¡ch táº¥t cáº£ cÃ¡c Ä‘á»‘i tÆ°á»£ng Audio
    const audios = [
        document.getElementById('sndAmber'),
        document.getElementById('sndRed'),
        document.getElementById('sndGreen'),
        btnClickSound // Ä‘á»‘i tÆ°á»£ng Ä‘Ã£ Ä‘Æ°á»£c khai bÃ¡o
    ];

    // Cá»‘ gáº¯ng phÃ¡t vÃ  dá»«ng ngay láº­p tá»©c táº¥t cáº£ cÃ¡c Ã¢m thanh
    audios.forEach(audio => {
        if (audio) {
            // DÃ¹ng play().catch() Ä‘á»ƒ trÃ¡nh lá»—i Uncaught Promise
            audio.play().then(() => {
                audio.pause();
                audio.currentTime = 0;
            }).catch(() => {});
        }
    });

    audioUnlocked = true;
    
    // XÃ³a listener sau khi Ä‘Ã£ má»Ÿ khÃ³a thÃ nh cÃ´ng
    document.removeEventListener('touchstart', unlockAudio);
    document.removeEventListener('click', unlockAudio);
}

// Gáº¯n sá»± kiá»‡n má»Ÿ khÃ³a vÃ o tÆ°Æ¡ng tÃ¡c Ä‘áº§u tiÃªn cá»§a ngÆ°á»i dÃ¹ng
document.addEventListener('touchstart', unlockAudio, {once: true});
document.addEventListener('click', unlockAudio, {once: true});
// Gáº¯n vÃ o táº¥t cáº£ cÃ¡c nÃºt
document.addEventListener("DOMContentLoaded", () => {
    const btns = [
        document.getElementById("resetBtn"),
        document.getElementById("revBtn"),
        document.getElementById("helpBtn"),
        document.getElementById("reviewBtn"),
        document.getElementById("closeHelp"),
        document.getElementById("closeReview"),
        document.getElementById("clearHistoryBtn")
    ];

    btns.forEach(btn => {
        if (btn) {
            btn.addEventListener("click", playBtnSound);
        }
    });
});

</script>
<audio id="sndAmber" src="alert-amber.mp3" preload="auto"></audio>
<audio id="sndRed"   src="alert-red.mp3" preload="auto"></audio>
<audio id="sndGreen" src="success.mp3" preload="auto"></audio>
<script>
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js")
    .then(() => console.log("SW registered"))
    .catch(err => console.error("SW failed", err));
}
</script>

</script>

</body>

</html> 



